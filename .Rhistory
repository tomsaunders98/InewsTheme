panel.grid.minor = element_blank(),
#formatting text
plot.title = element_text(size = rel(1.5), colour = "#000000", family = "Bitter", face="bold", hjust = 0),
text = element_text(size=rel(1), family="Bitter", colour = "#898a8c"),
plot.subtitle = element_text(size = rel(1.1), colour = "#525354", family="Bitter", hjust=0, margin=margin(t=5)),
plot.caption = element_text(family="Bitter", colour = "#898a8c", size = rel(0.5), hjust = 0)
)
}
#' Inews ggparlaiment theme
#'
#' @param base_size Basic size of graph, defaults to 25
#' @param base_family base font family, not implemented
theme_inews_parl <- function(base_size = 25, base_family="") {
theme_void(base_size = base_size, base_family = base_family) %+replace%
theme(
#Format Legend
legend.title = element_blank(),
legend.position = "top",
legend.direction = "horizontal",
legend.justification = "left",
legend.spacing = unit(0, "points"),
legend.key.size = unit(1, "lines"),
legend.key.height = NULL,
legend.key.width = NULL,
legend.margin = margin(t = 0, r = 5, b = 0, l = 5, unit = "pt"),
legend.box.margin = margin(t = 5, r = 0, b = 0, l = 0, unit = "pt"),
legend.box.spacing = unit(4, "points"),
legend.text = element_text(size = 10),
#Format plot (with margins)
plot.title.position = "panel",
plot.margin = margin(t = 0, r = 5, b = 0, l = 5, unit = "cm"),
#Format titles/text formatting
plot.title = element_text(size = rel(15), colour = "#000000", family = "Bitter", face = "bold", hjust = 0),
text = element_text(size = rel(1), family = "Bitter", colour = "#898a8c"),
plot.subtitle = element_text(size = rel(10), colour = "#525354", family = "Bitter", hjust = 0, margin=margin(t=5)),
plot.caption = element_text(family = "Bitter", colour = "#898a8c", size = rel(0.5), hjust = 0)
)
}
theme_inews_facet <- function(base_size = 25, base_family="") {
theme_inews_basic(base_size = base_size, base_family = base_family) %+replace%
theme(
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust=0.5)
)
}
#' Inews map theme
#'
#' @param base_size Basic size of graph, defaults to 25
#' @param base_family base font family, not implemented
theme_inews_map <- function(base_size = 25, base_family=""){
theme_void(base_size = 25, base_family = "") %+replace%
theme(
#Format legend
legend.title = element_blank(),
legend.position = "right",
legend.direction = "vertical",
legend.justification = "right",
legend.spacing = unit(0, "points"),
legend.key.size = unit(2, "lines"),
legend.key.height = NULL,
legend.key.width = NULL,
legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
legend.box.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "pt"),
legend.box.spacing = unit(4, "points"),
legend.text = element_text(size = rel(0.9)),
#Format text elements
plot.title = element_text(size = rel(1.5), colour = "#000000", family = "Bitter", face = "bold",  hjust = 0),
text = element_text(size = rel(1), family = "Bitter", colour = "#898a8c"),
plot.subtitle = element_text(size = rel(1.1), colour = "#525354", family = "Bitter", hjust = 0, margin=margin(t=5)),
plot.caption = element_text(family = "Bitter", colour = "#898a8c", size = rel(0.5), hjust = 0),
#Add small margin
plot.margin = margin(t = 10,r = 10, b = 10,l =10, unit = "pt")
)
}
#' Save plots (ggsave wrapper)
#' @param filename The filename specified
#' @param plot The plot to render, defaults to last plot
#' @param width_i Specified width in cm, defaults to 15
#' @param height_i Specified height in cm, defaults to 10
#' @param type Adds presets for maps/parls and other types to render
#' @param l_size Enables to turn off limiting size
save_inews <- function(filename, plot=last_plot(), width_i = 15, height_i = 10, type="basic", l_size=TRUE){
# Add copyright
cap_all <- ggplot_build(plot)
cap <-  cap_all[[3]][[9]]$caption
newcap <- paste(cap, "© The I", sep="\n")
plot <- plot +
labs(caption = newcap)
# Add presets:
if (type == "map"){
height_i = 25
width_i = 25
} else if (type == "parl"){
height_i= 20
width_i = 20
}
ggsave(filename, plot, dpi = 300, type = "cairo", width = width_i, height = height_i, units = "cm", limitsize = l_size)
}
library(InewsTheme)
devtools::document()
library("tidyverse")
library(InewsTheme, verbose=TRUE)
library(Cairo)
library(ggalt)
library(gapminder)
mtcars <- mtcars %>%
mutate(
am = as.factor(am)
)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, colour = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List", "Green List", "Red List"), values=c("#f47702", "#17b50c", "#f41202"))
cap_all <- ggplot_build(plot)
cap_all <- ggplot_build(last_plot())
View(cap_all)
test <- layer_grob(last_plot())
View(test)
test <_ layer_scales(last_plot())
test <- layer_scales(last_plot())
View(test)
test <- layer_data(last_plot())
View(test)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, colour = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List RPEROIAPNOINARO{EAINROEAN", "Green List OERNAEINROAEINROAIENR", "Red List AIRNAEINRPAEINRPAIENRPIAERN"), values=c("#f47702", "#17b50c", "#f41202")) +
theme(
legend.key.height = units(2, "cm")
)
save_inews("test.png")
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, colour = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List RPEROIAPNOINARO{EAINROEAN", "Green List OERNAEINROAEINROAIENR", "Red List AIRNAEINRPAEINRPAIENRPIAERN"), values=c("#f47702", "#17b50c", "#f41202")) +
theme(
legend.key.height = unit(2, "cm")
)
save_inews("test.png")
View(cap_all)
mtcars <- mtcars %>%
mutate(
am = as.factor(am)
)
find_name <- function(obj, name) {
# get all named paths through obj
find_paths <- function(obj, path) {
if ((!is.list(obj) && is.null(names(obj))) || identical(obj, .GlobalEnv)) {
return (path)
} else {
if (is.null(names(obj))) {
return(c(path,
lapply(seq_along(obj), function(x) find_paths(obj[[x]], paste0(path, "[[", x, "]]")))
))
} else {
return(c(path,
lapply(names(obj), function(x) find_paths(obj[[x]], paste(path, x, sep = "$")))
))
}
}
}
# get all the paths through the nested structure
all_paths <- unlist(find_paths(obj, deparse(substitute(obj))))
# find the requested name
path_to_name <- grep(paste0("\\$", name, "$"), all_paths, value = TRUE)
return (path_to_name)
}
find_name(cap_all, "Amber")
find_name(cap_all, "Amber List")
find_name(cap_all, "legend")
find_name(cap_all, "guide")
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, colour = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List RPEROIAPNOINARO{EAINROEAN", "Green List OERNAEINROAEINROAIENR", "Red List AIRNAEINRPAEINRPAIENRPIAERN"), values=c("#f47702", "#17b50c", "#f41202")) +
theme(
legend.key.height = unit(2, "cm")
)
cap_all <- ggplot_build(last_plot())
find_name(cap_all, "Amber List RPEROIAPNOINARO{EAINROEAN")
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, colour = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List", "Green List", "Red List AIRNAEINRPAEINRPAIENRPIAERN"), values=c("#f47702", "#17b50c", "#f41202")) +
theme(
legend.key.height = unit(2, "cm")
)
cap_all <- ggplot_build(last_plot())
find_name(cap_all, "Amber List RPEROIAPNOINARO{EAINROEAN")
find_name(cap_all, "Amber List")
find_name(cap_all, "Green List")
find_name(cap_all, "legend")
find_name(cap_all, "guide")
find_name(cap_all, "color")
find_name(cap_all, "colour")
cap_all$plot$labels$colour
cap_all$data[[1]]
find_name(cap_all, "labels")
find_na,e(cap_all, "discrete")
find_name(cap_all, "discrete")
find_name(cap_all, "manual")
t <- grid.ls(grid.force(cap_all))
library("grid")
t <- grid.ls(grid.force(cap_all))
t <- ggplotGrob(cap_all)
t <- ggplotGrob(last_plot())
grid.ls(grid.force(t))
rev <- grid.ls(grid.force(t))
View(rev)
rev$name
get_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
get_legend((last_plot()))
t <- get_legend((last_plot()))
View(t)
g1 <- function(a.gplot){
if (!gtable::is.gtable(a.gplot))
a.gplot <- ggplotGrob(a.gplot)
leg <- which(sapply(a.gplot$grobs, function(x) x$name) == "guide-box")
a.gplot$grobs[[leg]]
}
g1(last_plot())
grob <- grid::makeContent(layer_grob(last_plot(), 2)[[1]])$children
grob <- grid::makeContent(layer_grob(last_plot(), 2)
grob <- grid::makeContent(layer_grob(last_plot(), 2)[[1]])$children
grob <- grid::makeContent(layer_grob(last_plot(), 2)[[1]])$children
labels <- unname(vapply(ggplotGrob(last_plot()), function(x){x$label}, character(1)))
labels <- unname(vapply(ggplotGrob(last_plot()), function(x){x$guide-box}, character(1)))
test <- gtable_filter(ggplot_gtable(ggplot_build(last_plot())), "guide-box")
library("gtable")
test <- gtable_filter(ggplot_gtable(ggplot_build(last_plot())), "guide-box")
View(test)
View(test)
grobTree(test.label)
grobTree(test.labels)
grobTree(test.names)
grobTree(test.colour)
grobTree(test)
grobTree(test.name)
get_legend <- function(p, position = NULL){
if(is.null(p)) return(NULL)
if(!is.null(position)){
p <- p + theme(legend.position = position)
}
tmp <- ggplot_gtable(ggplot_build(p))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
if(length(leg) > 0) leg <- tmp$grobs[[leg]]
else leg <- NULL
leg
}
get_legend(last_plot())
library(InewsTheme)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
library("tidyverse")
library(InewsTheme, verbose=TRUE)
library(Cairo)
library(ggalt)
library(gapminder)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
mtcars <- mtcars %>%
mutate(
am = as.factor(am)
)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
inews_save("test.png")
save_inews("test.png")
library(InewsTheme)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
save_inews("test.png")
library(InewsTheme)
save_inews("test.png")
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
save_inews("test.png")
library(tidyverse)
library(InewsTheme)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
t <- grid.ls(grid.force(cap_all))
save_inews("test.png")
save_inews <- function(filename, plot=last_plot(), width_i = 15, height_i = 10, type="basic", l_size=TRUE){
cap_all <- ggplot_build(plot)
################ Auto Formatting Legends ###############
plotAndPrintRatio <- function(g, width, height) {
gGrob <- ggplotGrob(g)
tmpfile <- tempfile(pattern = "png")
png(tmpfile, width = width, height = height, units="cm", res=300) # it is necessary to open a device
plot(g)
legendSize <- as.numeric(convertWidth(grobWidth(gGrob$grobs[[15]]), unitTo = "inches"))
plotSize <-   as.numeric(convertWidth(grobWidth(gGrob$grobs[[7]]), unitTo = "inches"))
# the ratio of legend size to plot size
dev.off()
return(legendSize / plotSize)
}
val <- plotAndPrintRatio(plot, width_i, height_i)
if(val > 1){
rows = ceiling(val)
pos_tps <- names(cap_all[[3]][[9]])
if ("colour" %in% pos_tps){
plot <- plot + guides(colour = guide_legend(nrow = rows))
}
if ("fill" %in% pos_tps){
plot <- plot + guides(fill = guide_legend(nrow = rows))
}
if ("size" %in% pos_tps){
plot <- plot + guides(size = guide_legend(nrow = rows))
}
if ("linetype" %in% pos_tps){
plot <- plot + guides(linetype = guide_legend(nrow = rows))
}
if ("alpha" %in% pos_tps){
plot <- plot + guides(alpha = guide_legend(nrow = rows))
}
}
# Add copyright
cap <-  cap_all[[3]][[9]]$caption
cap <- paste(cap, "By Tom Saunders", sep="\n")
newcap <- paste(cap, "© The I", sep="\n")
plot <- plot +
labs(caption = newcap)
# Add presets:
if (type == "map"){
height_i = 25
width_i = 25
} else if (type == "parl"){
height_i= 20
width_i = 20
}
ggsave(filename, plot, dpi = 300, type = "cairo", width = width_i, height = height_i, units = "cm", limitsize = l_size)
}
mtcars <- mtcars %>%
mutate(
am = as.factor(am)
)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
save_inews("test.png")
library(grid)
save_inews <- function(filename, plot=last_plot(), width_i = 15, height_i = 10, type="basic", l_size=TRUE){
cap_all <- ggplot_build(plot)
################ Auto Formatting Legends ###############
plotAndPrintRatio <- function(g, width, height) {
gGrob <- ggplotGrob(g)
tmpfile <- tempfile(pattern = "png")
png(tmpfile, width = width, height = height, units="cm", res=300) # it is necessary to open a device
plot(g)
legendSize <- as.numeric(convertWidth(grobWidth(gGrob$grobs[[15]]), unitTo = "inches"))
plotSize <-   as.numeric(convertWidth(grobWidth(gGrob$grobs[[7]]), unitTo = "inches"))
# the ratio of legend size to plot size
dev.off()
return(legendSize / plotSize)
}
val <- plotAndPrintRatio(plot, width_i, height_i)
if(val > 1){
rows = ceiling(val)
pos_tps <- names(cap_all[[3]][[9]])
if ("colour" %in% pos_tps){
plot <- plot + guides(colour = guide_legend(nrow = rows))
}
if ("fill" %in% pos_tps){
plot <- plot + guides(fill = guide_legend(nrow = rows))
}
if ("size" %in% pos_tps){
plot <- plot + guides(size = guide_legend(nrow = rows))
}
if ("linetype" %in% pos_tps){
plot <- plot + guides(linetype = guide_legend(nrow = rows))
}
if ("alpha" %in% pos_tps){
plot <- plot + guides(alpha = guide_legend(nrow = rows))
}
}
# Add copyright
cap <-  cap_all[[3]][[9]]$caption
cap <- paste(cap, "By Tom Saunders", sep="\n")
newcap <- paste(cap, "© The I", sep="\n")
plot <- plot +
labs(caption = newcap)
# Add presets:
if (type == "map"){
height_i = 25
width_i = 25
} else if (type == "parl"){
height_i= 20
width_i = 20
}
ggsave(filename, plot, dpi = 300, type = "cairo", width = width_i, height = height_i, units = "cm", limitsize = l_size)
}
mtcars <- mtcars %>%
mutate(
am = as.factor(am)
)
ggplot(data=mtcars,aes(x=hp, y=mpg, group = am, fill = am))+
geom_line(aes(group = am, colour = am), size = 1.5) +
scale_y_continuous(expand = expansion(mult = c(0, .1))) +
theme_inews_basic() +
labs(title = "Covid-19 Travel Restrictions", caption = "source:mtcars dataset \n © Inews") +
scale_colour_manual(labels=c("Amber List Amber ListAmber ListAmber ListAmber ListAmber List", "Green ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber ListAmber List "), values=c("#f47702", "#17b50c"))
save_inews("test.png")
inews_fill_steps<- function(..., values = NULL, pallete = "blue", width = NULL, colours = NULL, breaks = NULL, space = "Lab", na.value = "grey50",
guide = "coloursteps", aesthetics = "fill"){
find_origin <- function(x_range, width, boundary) {
shift <- floor((x_range[1] - boundary) / width)
boundary + shift * width
}
# Detect Pallette
if (is.null(colours)){
if (pallette == "blue"){
colours = c("#0D5750","#176F79","#247598","#3474b4","#54A5C1","#73CCCE","#94DACA","#B4E6CF")
}
}
# Compute Breaks
if (is.null(breaks)){
if (is.null(width)) {
message("Must specify either breaks or break size")
}
width = as.numeric(width)
boundary <- width / 2
x_range <- range(values, na.rm = TRUE, finite = TRUE)
min_x <- find_origin(x_range, width, boundary)
max_x <- max(x, na.rm = TRUE) + (1 - 1e-08) * width
breaks <- seq(min_x, max_x, width)
}
binned_scale(aesthetics, "stepsn",
gradient_n_pal(colours, values, space), na.value = na.value, guide = guide, breaks = breaks, ...)
}
devtools::document()
library(InewsTheme)
combn(c((1,2,3,4)))
combn(c((1,2,3,4)), 2)
combn(c(1,2,3,4), 2)
library(ggplot2)
cut_number(c(1,2,3,4,5), 2)
cut_number(c(1,2,3,4,5), 3)
cut_number(c(1,2,3,4,5), 4)
split(c(1,2,3,4,5,6), 2)
split(c(1,2,3,4,5,6), 5)
x <- c(1,2,3,4,5,6,7)
n <- 2
split(x,cut(seq_along(x),n,labels = FALSE))
n <- 3
split(x,cut(seq_along(x),n,labels = FALSE))
combn(x.n)
combn(x,n)
library(classInt)
r = rnorm(100)
classIntervals?
n = rnorm(100)
n = rnorm(100)
t = classIntervals(t, n, style = "jenks")
t = classIntervals(t, 5, style = "jenks")
t = classIntervals(x, 2, style = "jenks")
View(t)
t[brks]
t["brks"]
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
library(InewsTheme)
